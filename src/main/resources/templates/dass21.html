<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindCare - DASS-21 Assessment</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: #f6f7fb; color: #2e2e2e; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(90deg, rgba(140, 122, 230, 0.1), rgba(165, 180, 252, 0.1)); border-radius: 16px; padding: 24px; margin-bottom: 24px; text-align: center; }
        .header h1 { font-size: 24px; margin-bottom: 8px; color: #2e2e2e; }
        .header p { color: #64748b; }
        .card { background: white; border-radius: 16px; padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .progress-info { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 14px; color: #64748b; }
        .category-tag { display: inline-block; background: #d8cff7; padding: 4px 12px; border-radius: 20px; font-size: 12px; margin-bottom: 15px; }
        .progress-bar { height: 8px; background: rgba(140, 122, 230, 0.2); border-radius: 4px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: #8c7ae6; width: 5%; transition: width 0.3s ease; }
        .question-text { font-size: 18px; margin-bottom: 20px; font-weight: 500; }
        .options { display: flex; flex-direction: column; gap: 10px; margin-bottom: 25px; }
        .option { display: flex; align-items: center; gap: 12px; padding: 15px; border: 1px solid rgba(140, 122, 230, 0.2); border-radius: 12px; cursor: pointer; transition: all 0.2s; }
        .option:hover { border-color: #8c7ae6; background: rgba(140, 122, 230, 0.05); }
        .option.selected { border-color: #8c7ae6; background: rgba(140, 122, 230, 0.1); }
        .option-radio { width: 16px; height: 16px; border: 2px solid #8c7ae6; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .option-radio::after { content: ''; width: 8px; height: 8px; border-radius: 50%; background: #8c7ae6; display: none; }
        .option.selected .option-radio::after { display: block; }
        .assessment-buttons { display: flex; gap: 12px; }
        .assessment-btn { 
            flex: 1; 
            padding: 12px; 
            border: none; 
            border-radius: 10px; 
            font-size: 14px; 
            font-weight: 500; 
            cursor: pointer; 
            transition: all 0.2s; 
        }
        .assessment-btn.prev { background: #f6f7fb; border: 1px solid rgba(140,122,230,0.2); color: #64748b; }
        .assessment-btn.next { background: #8c7ae6; color: white; }
        .assessment-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .disclaimer { background: rgba(216, 207, 247, 0.2); border: 1px solid rgba(140, 122, 230, 0.2); border-radius: 16px; padding: 16px; text-align: center; color: #64748b; font-size: 14px; }
    </style>
</head>
<body>
    <div th:replace="~{fragments/navbar :: navbar('assessment')}"></div>
    
    <div class="container">
        <div class="header">
            <h1>DASS-21 Self-Assessment</h1>
            <p>Please read each statement and indicate how much it applied to you over the past week</p>
        </div>

        <form id="assessment-form" action="/mindcare/assessment/results" method="post">
            <div class="card">
                <div class="progress-info">
                    <span>Question <span id="current-question">1</span> of 21</span>
                    <span><span id="percent-complete">5</span>% complete</span>
                </div>
                
                <div class="category-tag" id="category-tag">Category</div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                
                <div class="question-text" id="question-text">Loading question...</div>
                
                <div class="options" id="options-container">
                    <!-- Options will be added by JavaScript -->
                </div>
                
                <div class="assessment-buttons">
                    <button type="button" class="assessment-btn prev" id="prev-btn" disabled>Previous</button>
                    <button type="button" class="assessment-btn next" id="next-btn">Next</button>
                </div>
            </div>
        </form>

        <div class="disclaimer">
            DASS-21 is a validated screening tool. This assessment is for informational purposes only and does not replace professional diagnosis.
        </div>
    </div>

    <script>
        // Simple questions array
        const questions = [
            "I found it hard to wind down",
            "I was aware of dryness of my mouth", 
            "I couldn't seem to experience any positive feeling at all",
            "I experienced breathing difficulty",
            "I found it difficult to work up the initiative to do things",
            "I tended to overreact to situations",
            "I experienced trembling (e.g., in the hands)",
            "I felt that I was using a lot of nervous energy",
            "I was worried about situations in which I might panic and make a fool of myself",
            "I felt that I had nothing to look forward to",
            "I found myself getting agitated",
            "I found it difficult to relax",
            "I felt downhearted and blue",
            "I was intolerant of anything that kept me from getting on with what I was doing",
            "I felt I was close to panic",
            "I was unable to become enthusiastic about anything",
            "I felt I wasn't worth much as a person",
            "I felt that I was rather touchy",
            "I was aware of the action of my heart in the absence of physical exertion",
            "I felt scared without any good reason",
            "I felt that life was meaningless"
        ];

        const categories = [
            "Stress", "Anxiety", "Depression", "Anxiety", "Depression", "Stress",
            "Anxiety", "Stress", "Anxiety", "Depression", "Stress", "Stress", 
            "Depression", "Stress", "Anxiety", "Depression", "Depression", "Stress",
            "Anxiety", "Anxiety", "Depression"
        ];

        const options = [
            "Did not apply to me at all",
            "Applied to me to some degree, or some of the time", 
            "Applied to me to a considerable degree, or a good part of the time",
            "Applied to me very much, or most of the time"
        ];

        let currentQuestion = 0;
        let userAnswers = new Array(questions.length).fill(null);

        // Get all HTML elements we need
        const questionText = document.getElementById('question-text');
        const categoryTag = document.getElementById('category-tag');
        const optionsContainer = document.getElementById('options-container');
        const currentQuestionEl = document.getElementById('current-question');
        const percentCompleteEl = document.getElementById('percent-complete');
        const progressFill = document.getElementById('progress-fill');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const form = document.getElementById('assessment-form');

        // Show the current question
        function showQuestion() {
            // Update question text and category
            questionText.textContent = questions[currentQuestion];
            categoryTag.textContent = categories[currentQuestion];
            
            // Update progress
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            currentQuestionEl.textContent = currentQuestion + 1;
            percentCompleteEl.textContent = Math.round(progress);
            progressFill.style.width = progress + '%';
            
            // Create option buttons
            optionsContainer.innerHTML = '';
            for (let i = 0; i < options.length; i++) {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                if (userAnswers[currentQuestion] === i) {
                    optionDiv.classList.add('selected');
                }
                
                optionDiv.innerHTML = `
                    <div class="option-radio"></div>
                    <div>${options[i]}</div>
                `;
                
                optionDiv.onclick = function() {
                    userAnswers[currentQuestion] = i;
                    showQuestion(); // Refresh to show selection
                };
                
                optionsContainer.appendChild(optionDiv);
            }
            
            // Update buttons
            prevBtn.disabled = currentQuestion === 0;
            nextBtn.textContent = currentQuestion === questions.length - 1 ? 'Submit' : 'Next';
        }

        // Go to next question
        function nextQuestion() {
            if (userAnswers[currentQuestion] === null) {
                alert('Please select an answer before continuing.');
                return;
            }
            
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                submitForm();
            }
        }

        // Go to previous question  
        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
            }
        }

        // Submit the form
        function submitForm() {
            // Add answers to form as hidden inputs
            for (let i = 0; i < userAnswers.length; i++) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'responses';
                input.value = userAnswers[i];
                form.appendChild(input);
            }
            
            form.submit();
        }

        // Set up button clicks
        prevBtn.addEventListener('click', prevQuestion);
        nextBtn.addEventListener('click', nextQuestion);

        // Start the assessment
        showQuestion();
    </script>
</body>
</html>